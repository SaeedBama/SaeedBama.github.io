<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turf Booking Verification</title>

<style>
/* ==== YOUR ORIGINAL STYLES (UNCHANGED) ==== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container { max-width: 800px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 30px; color: white; }
.header h1 { font-size: 2em; margin-bottom: 10px; }
.header p { font-size: 1.1em; opacity: 0.9; }

.search-card, .booking-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.search-card { margin-bottom: 30px; }

.search-box { display: flex; gap: 10px; margin-bottom: 15px; }
.search-box input {
    flex: 1;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
}
.search-box button {
    padding: 15px 30px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
}

.error-message {
    background: #fee;
    color: #c33;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    display: none;
}

.loading {
    text-align: center;
    padding: 40px;
    display: none;
}

.booking-card { display: none; }

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
}

.payment-status {
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9em;
}

.status-paid { background: #c6f6d5; }
.status-pending { background: #feebc8; }

</style>
</head>

<body>

<div class="container">
    <div class="header">
        <h1>üèüÔ∏è Turf Booking Verification</h1>
        <p>Scan QR code to verify your booking</p>
    </div>

    <div class="search-card" id="searchCard">
        <h2>Manual Entry (Backup)</h2>
        <div class="search-box">
            <input type="text" id="bookingId" placeholder="Enter Booking ID">
            <button onclick="searchBooking()" id="searchBtn">Verify</button>
        </div>
    </div>

    <div class="error-message" id="errorMessage"></div>

    <div class="loading" id="loading">
        <p>Loading booking...</p>
    </div>

    <div class="booking-card" id="bookingCard">
        <h2 id="turfName"></h2>
        <p id="bookingIdDisplay"></p>

        <div class="detail-row">
            <span>Team:</span>
            <span id="teamName"></span>
        </div>

        <div class="detail-row">
            <span>Time:</span>
            <span id="time"></span>
        </div>

        <div class="detail-row">
            <span>Total:</span>
            <span id="totalAmount"></span>
        </div>

        <div class="detail-row">
            <span>Status:</span>
            <span id="paymentStatus"></span>
        </div>
    </div>
</div>


<!-- ============================= -->
<!-- üî• LOAD FIREBASE SDK FIRST -->
<!-- ============================= -->

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
/* ============================= */
/* üî• FIREBASE CONFIG */
/* ============================= */

const firebaseConfig = {
    apiKey: "AIzaSyBfqQ7g-6sVESqtDK36CUe1H27WT1H7ZlM",
    authDomain: "turffootball-796d4.firebaseapp.com",
    projectId: "turffootball-796d4",
    storageBucket: "turffootball-796d4.firebasestorage.app",
    messagingSenderId: "498899007163",
    appId: "1:498899007163:web:c40910938244d093649b9e"
};

/* Initialize Firebase */
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ============================= */
/* UTIL FUNCTIONS */
/* ============================= */

function getUrlParameter(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
}

function showError(message) {
    const el = document.getElementById('errorMessage');
    el.textContent = message;
    el.style.display = 'block';
}

function hideError() {
    document.getElementById('errorMessage').style.display = 'none';
}

function showLoading(show) {
    document.getElementById('loading').style.display = show ? 'block' : 'none';
}

/* ============================= */
/* AUTO LOAD FROM QR */
/* ============================= */

window.addEventListener("DOMContentLoaded", async () => {

    const bookingId = getUrlParameter('bookingId');

    if (bookingId) {
        showLoading(true);

        try {
            const doc = await db.collection("monthly_bookings")
                                .doc(bookingId)
                                .get();

            if (doc.exists) {
                displayBooking(doc.id, doc.data());
            } else {
                showError("Booking not found.");
            }

        } catch (error) {
            console.error(error);
            showError("Error loading booking.");
        }

        showLoading(false);
    }
});

/* ============================= */
/* MANUAL SEARCH */
/* ============================= */

async function searchBooking() {

    const bookingId = document.getElementById('bookingId').value.trim();

    if (!bookingId) {
        showError("Please enter Booking ID.");
        return;
    }

    hideError();
    showLoading(true);

    try {
        const doc = await db.collection("monthly_bookings")
                            .doc(bookingId)
                            .get();

        if (doc.exists) {
            displayBooking(doc.id, doc.data());
        } else {
            showError("Booking not found.");
        }

    } catch (error) {
        console.error(error);
        showError("Error fetching booking.");
    }

    showLoading(false);
}

/* ============================= */
/* DISPLAY BOOKING */
/* ============================= */

function displayBooking(id, data) {

    document.getElementById("searchCard").style.display = "none";
    document.getElementById("bookingCard").style.display = "block";

    document.getElementById("turfName").textContent = data.turfName || "N/A";
    document.getElementById("bookingIdDisplay").textContent = "ID: " + id;
    document.getElementById("teamName").textContent = data.teamName || "N/A";
    document.getElementById("time").textContent =
        (data.startTime && data.endTime)
        ? data.startTime + " - " + data.endTime
        : "N/A";

    document.getElementById("totalAmount").textContent =
        "KES " + (data.totalAmount || 0);

    const status = data.paymentStatus || "pending";
    const statusEl = document.getElementById("paymentStatus");
    statusEl.textContent = status.toUpperCase();
    statusEl.className =
        "payment-status " + (status === "paid" ? "status-paid" : "status-pending");
}

</script>

</body>
</html>
